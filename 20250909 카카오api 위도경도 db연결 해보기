========yml========
spring:
  datasource:
    driver-class-name: com.mysql.cj.jdbc.Driver
    url: jdbc:mysql://localhost:3306/productdb
    username: ???
    password: ???

## mybatis config
mybatis:
  mapper-locations: mappers/**/*.xml


@Controller
@RequestMapping("/menu")
public class KakaoController {

    private final KakaoService kakaoService;

    public KakaoController(KakaoService kakaoService) {
        this.kakaoService = kakaoService;
    }

    @GetMapping("/kakao")
    public String registOrder() {
        return "menu/kakao";
    }

    @ResponseBody
    @GetMapping("/markers")
    public List<KaKaoMapDTO> markers(){
         return kakaoService.getAllMarkers();
    }
 }

 @Service
public class KakaoService {
    private final KakaoMapper kakaoMapper;

    public KakaoService(KakaoMapper kakaoMapper) {
        this.kakaoMapper = kakaoMapper;
    }

    public List<KaKaoMapDTO> getAllMarkers() {

        return kakaoMapper.selectAllMarkers();
    }
}

@Mapper
public interface KakaoMapper {
    List<KaKaoMapDTO> selectAllMarkers();
}

<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ohgiraffers.kakaoapitest.menu.model.dao.KakaoMapper">
    <resultMap id="kakaoMapSample" type="com.ohgiraffers.kakaoapitest.menu.model.dto.KaKaoMapDTO">
        <id property="bikeNo" column="product_no"/>
        <result property="franchise" column="franchise"/>
        <result property="lat" column="lat"/>
        <result property="lng" column="lng"/>
        <result property="priority" column="priority"/>
    </resultMap>

    <select id="selectAllMarkers" resultMap="kakaoMapSample">
        SELECT
        product_no,
        franchise,
        lat,
        lng,
        priority
        FROM bike_sample
    </select>
</mapper>

 fetch('/menu/markers')
          .then(res => {
            if (!res.ok) throw new Error('HTTP ' + res.status);
            return res.json();
          })
          .then(list => {
            if (!Array.isArray(list) || list.length === 0) {
              addBotMessage('í‘œì‹œí•  ìì „ê±°ê°€ ì—†ìŠµë‹ˆë‹¤.');
              return;
            }

            // ëª¨ë“  ë§ˆì»¤ê°€ ë³´ì´ë„ë¡ ê²½ê³„(Bounds) ê³„ì‚°
            const bounds = new kakao.maps.LatLngBounds();

            list.forEach(pos => {
              // lat/lngê°€ ìˆ«ìê°€ ì•„ë‹ ê²½ìš°(ì˜ëª»ëœ ë°ì´í„°) ê±´ë„ˆë›°ê¸°
              if (typeof pos.lat !== 'number' || typeof pos.lng !== 'number') return;

              const latlng = new kakao.maps.LatLng(pos.lat, pos.lng);
              bounds.extend(latlng);

              // ì‹¤ì œ ì§€ë„ì— ë§ˆì»¤ ì¶”ê°€
              const marker = new kakao.maps.Marker({
                map,
                position: latlng,
                title: pos.franchise ?? pos.bikeNo,  // ë§ˆìš°ìŠ¤ì˜¤ë²„ íˆ´íŒ
                image: markerImage
              });

              // ë§ˆì»¤ í´ë¦­í•˜ë©´ ìƒì„¸ ì •ë³´ ì¹´ë“œ/ì˜ˆì•½ ë²„íŠ¼ í™œì„±í™”
              kakao.maps.event.addListener(marker, 'click', () => {
                lastSelected = {
                  bikeNo:   pos.bikeNo,
                  title:    pos.franchise || pos.bikeNo,
                  lat:      pos.lat,
                  lng:      pos.lng,
                  priority: pos.priority
                };

                infoBox.style.display = "block";
                infoBox.innerHTML = `
              ğŸ“ <b>${lastSelected.title}</b><br>
              ìì „ê±°ë²ˆí˜¸: ${lastSelected.bikeNo}<br>
              ìœ„ë„: ${lastSelected.lat.toFixed(6)}<br>
              ê²½ë„: ${lastSelected.lng.toFixed(6)}<br>
              ìš°ì„ ìˆœìœ„: ${lastSelected.priority}
            `;

                reserveBtn.disabled = false;       // ì˜ˆì•½ ê°€ëŠ¥ ìƒíƒœë¡œ
                chatBody.scrollTop = chatBody.scrollHeight;
              });
            });

            // ë§ˆì»¤ê°€ ì—¬ëŸ¬ ê°œë¼ë©´ ì§€ë„ë¥¼ ìë™ìœ¼ë¡œ ë§ì¶°ì¤Œ
            if (!bounds.isEmpty()) {
              map.setBounds(bounds, 30, 30, 30, 30); // ì—¬ë°±(padding) ì¡°ê¸ˆ ë„£ê¸°
            }
          })
          .catch(err => {
            console.error('ë§ˆì»¤ ë¡œë“œ ì‹¤íŒ¨:', err);
            addBotMessage('ë§ˆì»¤ ë¡œë“œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš”.');
          });
